{% extends "base.html" %}
{% load humanize %}
{% block title %}Qu·∫£n l√Ω h√†ng h√≥a - TH True Mart{% endblock %}
{% block page_title %}Qu·∫£n l√Ω h√†ng h√≥a{% endblock %}

{% block content %}
<div class="container-fluid">

  <!-- Thanh c√¥ng c·ª• -->
  <div class="bg-white p-3 rounded-3 shadow-sm mb-4">
    <div class="row g-2 align-items-center">
      <div class="col-md-4">
        <input type="text" class="form-control" placeholder="üîç T√¨m ki·∫øm s·∫£n ph·∫©m...">
      </div>
      <div class="col-md-4">
        <select class="form-select">
          <option>T·∫•t c·∫£ danh m·ª•c</option>
          {% for c in categories %}
          <option>{{ c.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 text-end">
        <a href="{% url 'add_product_master' %}" class="btn btn-success">
          <i class="fa-solid fa-plus me-1"></i> Th√™m s·∫£n ph·∫©m
        </a>
      </div>
    </div>
  </div>

  <!-- Danh s√°ch s·∫£n ph·∫©m -->
  <div class="bg-white p-3 rounded-3 shadow-sm">
    {% if products %}
    <table class="table table-bordered table-hover align-middle mb-0">
      <thead class="table-primary text-center">
        <tr>
          <th>M√£ SP</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Danh m·ª•c</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr class="align-middle text-center">
          <td class="fw-semibold text-primary">{{ p.product_code }}</td>
          <td class="text-start">{{ p.name }}</td>
          <td>{{ p.category.name }}</td>
          <td>
            {% if p.status == "active" %}
              <span class="badge bg-success px-3 py-2">Kinh doanh</span>
            {% else %}
              <span class="badge bg-secondary px-3 py-2">Ng·ª´ng KD</span>
            {% endif %}
          </td>
          <td class="text-center">
            <a href="{% url 'edit_product_master' p.product_code %}" class="btn btn-sm btn-outline-primary me-2">
              <i class="fa-solid fa-pen"></i> S·ª≠a
            </a>
            <a href="#" class="btn btn-sm btn-outline-danger btn-delete" data-id="{{ p.product_code }}" data-name="{{ p.name }}">
              <i class="fa-solid fa-trash"></i> X√≥a
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
      <div class="text-center text-muted py-5">
        <i class="fa-regular fa-box-open fa-2x mb-3"></i>
        <div>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong danh s√°ch kinh doanh</div>
        <a href="{% url 'add_product_master' %}" class="btn btn-success mt-3">
          <i class="fa-solid fa-plus me-1"></i> Th√™m s·∫£n ph·∫©m
        </a>
      </div>
    {% endif %}
  </div>
</div>

<!-- STYLE -->
<style>
.table td, .table th { vertical-align: middle !important; }
.badge { font-weight: 600; }
.btn-outline-primary:hover { background-color: #0d6efd; color: #fff; }
.btn-outline-danger:hover { background-color: #dc3545; color: #fff; }
</style>

<!-- SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".btn-delete").forEach(btn => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      const id = this.dataset.id;
      const name = this.dataset.name;
      if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m "${name}" kh√¥ng?`)) {
        fetch(`/product-master/delete/${id}/`, {
          method: "POST",
          headers: { "X-CSRFToken": "{{ csrf_token }}" },
        })
        .then(res => res.ok ? location.reload() : alert("‚ùå L·ªói khi x√≥a!"))
        .catch(() => alert("‚ö†Ô∏è K·∫øt n·ªëi m√°y ch·ªß th·∫•t b·∫°i!"));
      }
    });
  });
});
</script>

{% endblock %}
