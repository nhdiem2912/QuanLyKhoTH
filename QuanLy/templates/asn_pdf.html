<!DOCTYPE html>
{% load humanize %}
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <style>
    @page { size: A4 portrait; margin: 1.5cm; }
    body {
      font-family: "DejaVu Sans", sans-serif;
      font-size: 13px;
      line-height: 1.5;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px 8px;
      vertical-align: middle;
    }
    th {
      background: #f2f2f2;
      text-align: center;
    }
    .fw-bold { font-weight: 700; }
    .text-center { text-align: center; }
    .text-right { text-align: right; }
    .text-primary { color: #0d6efd; }
    .text-success { color: #16a34a; }
    .title {
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      margin: 16px 0 12px 0;
    }
    .header-table td {
      border: none;
      padding: 2px 0;
      font-size: 12px;
    }
    .info-table {
      margin-top: 8px;
    }
    .info-table td {
      border: none;
      padding: 3px 0;
    }
    .sign-table {
      border: none;
      width: 100%;
      margin-top: 45px;
      text-align: center;
      table-layout: fixed;
    }
    .sign-table td {
      border: none;
      padding-top: 35px;
      font-size: 12px;
    }
    .signature-date {
      text-align: right;
      margin-top: 8px;
      font-size: 12px;
    }
    .summary-row td {
      background: #fafafa;
      font-weight: 700;
    }
    /* Bỏ viền giữa label & value trong dòng tổng */
    .no-right-border { border-right: none !important; }
    .no-left-border  { border-left:  none !important; }
  </style>
</head>

<body>

  <!-- HEADER -->
  <table class="header-table">
    <tr>
      <td width="65%">
        <strong>TH True Mart chi nhánh 397 Núi Thành - Đà Nẵng</strong><br>
        Địa chỉ: 397 Núi Thành - Đà Nẵng<br>
        Điện thoại: 0236 3734 001 &nbsp;&nbsp; Hotline: 094 266 9368
      </td>
      <td width="35%" style="text-align:right;">
        <div><strong>Mã ASN:</strong> <span class="text-primary">{{ asn.asn_code }}</span></div>
        <div><strong>PO liên kết:</strong> {{ asn.po.po_code|default:"-" }}</div>
      </td>
    </tr>
  </table>

  <div class="title">PHIẾU GIAO HÀNG (ASN)</div>

  <!-- INFO -->
  <table class="info-table">
    <tr>
      <td>Ngày tạo phiếu: <strong>{{ asn.created_date|date:"d/m/Y" }}</strong></td>
    </tr>
    <tr>
      <td>Ngày giao dự kiến: <strong>{{ asn.expected_date|date:"d/m/Y" }}</strong></td>
    </tr>
    <tr>
      <td>
        Nhà cung ứng:
        <strong>{{ asn.supplier.company_name }}</strong>
        {% if asn.supplier.contact_name or asn.supplier.phone %}
          –
          {% if asn.supplier.contact_name %}Người liên hệ: {{ asn.supplier.contact_name }}{% endif %}
          {% if asn.supplier.phone %} ({{ asn.supplier.phone }}){% endif %}
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        Người giao hàng:
        <strong>{{ asn.deliverer_name }}</strong>
        {% if asn.deliverer_phone %}
          – SĐT: {{ asn.deliverer_phone }}
        {% endif %}
      </td>
    </tr>
    <tr>
      <td>
        Người tạo phiếu:
        <strong>
          {% if asn.created_by %}
            {{ asn.created_by.get_full_name|default:asn.created_by.username }}
          {% else %}
            -
          {% endif %}
        </strong>
      </td>
    </tr>

    {% if asn.note %}
    <tr>
      <td>Ghi chú: <strong>{{ asn.note }}</strong></td>
    </tr>
    {% endif %}
  </table>

  <!-- MAIN TABLE -->
  <table style="margin-top: 14px;">
    <thead>
      <tr>
        <th style="width:5%;">STT</th>
        <th style="width:9%;">Mã SP</th>
        <th style="width:36%;">Tên sản phẩm</th>
        <th style="width:8%;">ĐVT</th>
        <th style="width:10%;">SL giao</th>
        <th style="width:12%;">Đơn giá (₫)</th>
        <th style="width:10%;">HSD</th>
        <th style="width:10%;">Thành tiền (₫)</th>
      </tr>
    </thead>

    <tbody>
      {% for item in asn.items.all %}
      <tr>
        <td class="text-center">{{ forloop.counter }}</td>
        <td class="text-center">{{ item.product.product_code }}</td>
        <td>{{ item.product.name }}</td>
        <td class="text-center">{{ item.unit }}</td>
        <td class="text-right">{{ item.quantity|intcomma }}</td>
        <td class="text-right">{{ item.unit_price|floatformat:0|intcomma }}</td>
        <td class="text-center">{{ item.expiry_date|date:"d/m/Y"|default:"-" }}</td>
        <td class="text-right text-success fw-bold">
          {{ item.total_value|floatformat:0|intcomma }}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8" class="text-center">Không có sản phẩm trong phiếu giao hàng</td>
      </tr>
      {% endfor %}
    </tbody>

    <tfoot>
      <tr class="summary-row">
        <!-- Tổng số lượng: không có viền ngăn giữa label & value -->
        <td colspan="4" class="text-right no-right-border">Tổng số lượng:</td>
        <td class="text-right no-left-border">{{ asn.total_quantity|intcomma }}</td>

        <!-- Tổng tiền: tương tự -->
        <td class="text-right no-right-border">Tổng tiền:</td>
        <td colspan="2" class="text-right no-left-border text-primary">
          {{ asn.total_value|floatformat:0|intcomma }} ₫
        </td>
      </tr>
    </tfoot>
  </table>

  <!-- SIGNATURE -->
  <div class="signature-date">
    Đà Nẵng, ngày {{ asn.created_date|date:"d" }} tháng {{ asn.created_date|date:"m" }} năm {{ asn.created_date|date:"Y" }}
  </div>

  <table class="sign-table">
    <tr>
      <td>Nhà cung ứng / Người giao hàng<br><em>(Ký, ghi rõ họ tên)</em></td>
      <td>Người nhận hàng<br><em>(Ký, ghi rõ họ tên)</em></td>
      <td>Quản lý cửa hàng<br><em>(Ký, ghi rõ họ tên)</em></td>
    </tr>
  </table>

</body>
</html>
