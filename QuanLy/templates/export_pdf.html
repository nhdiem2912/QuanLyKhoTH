<!DOCTYPE html>
{% load humanize %}
<html lang="vi">
<head>
<meta charset="UTF-8">
<style>
  @page { size: A4 portrait; margin: 1.5cm; }
  body { font-family: "DejaVu Sans", sans-serif; font-size: 13px; line-height: 1.4; }
  table { border-collapse: collapse; width: 100%; }
  th, td { border: 1px solid #000; padding: 6px; }
  th { background-color: #f2f2f2; text-align: center; }
  .text-center { text-align: center; }
  .text-left { text-align: left; }
  .text-right { text-align: right; }
  .fw-bold { font-weight: bold; }
  .text-danger { color: #d9534f; }
  .text-primary { color: #0d6efd; }
  .title { font-size: 18px; font-weight: bold; text-align: center; margin: 10px 0; }
  .header-table td { border: none; vertical-align: top; font-size: 13px; }
  .info-table td { border: none; padding: 4px 0; font-size: 13px; }
  .sign-table { border: none; width: 100%; margin-top: 40px; text-align: center; table-layout: fixed; }
  .sign-table td { border: none; width: 20%; vertical-align: top; padding-top: 25px; }
  .sign-table em { font-size: 11px; }
  .signature-date { text-align: right; margin-top: 10px; }
</style>
</head>

<body>

  <!-- HEADER -->
  <table class="header-table">
    <tr>
      <td width="70%">
        <strong>TH True Mart chi nhánh 397 Núi Thành - Đà Nẵng</strong><br>
        Địa chỉ: 397 Núi Thành - Đà Nẵng<br>
        Điện thoại: 0236 3734 001 &nbsp;&nbsp; Hotline: 094 266 9368
      </td>
      <td width="30%" style="text-align: right;">
        <strong>Số:</strong> <span style="color:red;">{{ receipt.export_code }}</span>
      </td>
    </tr>
  </table>

  <div class="title">PHIẾU XUẤT KHO</div>

  <!-- Thông tin -->
  <table class="info-table">
    <tr>
      <td>Ngày xuất: <strong>{{ receipt.export_date|date:"d/m/Y" }}</strong></td>
    </tr>

    <tr>
      <td>Người nhận hàng:
        <strong>{{ receipt.receiver_name|default:"................................" }}</strong>
        &nbsp;&nbsp; SĐT:
        <strong>{{ receipt.receiver_phone|default:"...................." }}</strong>
      </td>
    </tr>

    <tr>
      <td>Địa điểm giao hàng: <strong>{{ receipt.destination|default:".........................................." }}</strong></td>
    </tr>

    <tr>
      <td>Xuất tại kho:
        <strong>Kho TH True Mart chi nhánh 397 Núi Thành - Đà Nẵng</strong>
        &nbsp;&nbsp;&nbsp; Người lập phiếu:
        <strong>{{ receipt.created_by.username }}</strong>
      </td>
    </tr>
  </table>

  <!-- MAIN TABLE -->
  <table style="margin-top: 10px;">
    <thead>
      <tr>
        <th style="width:5%;">STT</th>
        <th style="width:35%;">TÊN HÀNG</th>
        <th style="width:10%;">LÔ (Phiếu nhập)</th>
        <th style="width:8%;">ĐVT</th>
        <th style="width:8%;">SL</th>
        <th style="width:13%;">ĐƠN GIÁ (₫)</th>
        <th style="width:8%;">CK (%)</th>
        <th style="width:13%;">THÀNH TIỀN (₫)</th>
      </tr>
    </thead>

    <tbody>
      {% for item in receipt.items.all %}
      <tr>
        <td class="text-center">{{ forloop.counter }}</td>

        <td class="text-left">
          {{ item.stock_item.product.name }}
          {% if item.stock_item.expiry_date %}
            <br><small>HSD: {{ item.stock_item.expiry_date|date:"d/m/Y" }}</small>
          {% endif %}
        </td>

        <td class="text-center">{{ item.stock_item.import_receipt.import_code }}</td>
        <td class="text-center">{{ item.unit }}</td>
        <td class="text-center">{{ item.quantity }}</td>

        <td class="text-right">{{ item.unit_price|floatformat:0|intcomma }}</td>
        <td class="text-center">{{ item.discount_percent|floatformat:0 }}</td>

        <td class="text-right">{{ item.total|floatformat:0|intcomma }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="8" class="text-center">Không có sản phẩm</td></tr>
      {% endfor %}
    </tbody>

    <tfoot>
      <tr>
        <td colspan="7" class="text-right fw-bold">Tổng chiết khấu:</td>
        <td class="text-right fw-bold text-danger">
          {{ receipt.total_discount|floatformat:0|intcomma }} ₫
        </td>
      </tr>
      <tr>
        <td colspan="7" class="text-right fw-bold">Tổng cộng sau giảm:</td>
        <td class="text-right fw-bold text-primary">
          {{ receipt.total_price|floatformat:0|intcomma }} ₫
        </td>
      </tr>
    </tfoot>
  </table>

  <!-- Phần chữ ký -->
  <div class="signature-date">
    Đà Nẵng, ngày {{ receipt.export_date|date:"d" }} tháng {{ receipt.export_date|date:"m" }} năm {{ receipt.export_date|date:"Y" }}
  </div>

  <table class="sign-table">
    <tr>
      <td>Người giao<br><em>(Ký, họ tên)</em></td>
      <td>Người nhận<br><em>(Ký, họ tên)</em></td>
      <td>Quản lý cửa hàng<br><em>(Ký, họ tên)</em></td>
    </tr>
  </table>

</body>
</html>
